<!DOCTYPE HTML>
<html>

<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <title> Job Portal </title>
</head>

<body>

    <nav class="navbar" id="insidenav">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">Job Portal</a>
            </div>

            <ul class="nav navbar-nav">
                <li class="active"><a href="#main1">Home</a></li>
                <li><a href="#jobseeker">Job Seeker</a></li>
                <li><a href="#employers">Employer</a></li>
                <li><a href="#contact">Contact Us</a></li>
            </ul>

            <ul class="nav navbar-nav navbar-right">
                <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <span class="glyphicon glyphicon-user"></span> Register <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="js_register.html">Jobseeker</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="emp_register.html">Employer</a></li>
                    </ul>
                </li>
                <li><a href="login1.html"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
            </ul>
        </div>
    </nav>
    <div class="bmsTop">
        <ul>
            <h2 style="font-size: 20px; font-weight: bold">Top Recruiters:</h2>
            <ul id="myUL">
                <li><a href="#">Amazon</a></li>
                <li><a href="#">Google</a></li>

                <li><a href="#">TCS</a></li>
                <li><a href="#">Coding Ninja</a></li>

                <li><a href="#">DeShaw</a></li>
                <li><a href="#">Morgan Stanley</a></li>
                <li><a href="#">Microsoft</a></li>
            </ul>
        </ul>
    </div>
    <h3 style=" font-weight: bold">Search for Jobs</h3>
    <div class="container-fluid" id="main1">
        <!-- jumbotron fluid -->
        <div class="jumbotron text-center" id="searchjum">
            <h2>Job Portal</h2>
            <p>Search By Skill, Location, Salary and More</p>
            <form class="form-inline" id="homesearch" method="GET" action="">
                <input type="text" class="form-control" size="50" placeholder="Enter your search keyword" name="keyword" id="keyword">
                <input type="text" class="form-control2" size="50" placeholder="Location, Title or " name="keyword2" id="keyword2">
                <!--button type="button" onclick="" class="btn btn-lg " style="color: black"-->
                <button type="submit" class="btn btn-lg " style="color: black">
                <span class="glyphicon glyphicon-search"></span> Search</button>
            </form>
        </div>
    </div>

    <div class="container" id="subcontent" style="background: transparent">
        <!-- div for search contents -->
    </div>
    <div class="page-header" style="background:#1abc9c"></div>
    <div class="container-fluid" style="background: transparent">
        <div class="text-center">
            <h2>Register</h2>
            <h4>Register in this website for a better experience</h4>
        </div>
        <div class="row">
            <div class="col-sm-4">
                <div class="panel panel-default text-center">
                    <div class="panel-heading">
                        <h1 id="employers">Employers</h1>
                    </div>
                    <div class="panel-body">
                        <p style="font-size: 16px">Register today and post a job in easy steps and start receiving
                            applications the same day.
                            Find the right candidates easily and quickly through our Search feature.</p>
                    </div>
                    <div class="panel-footer">
                        <a href="emp_register.html" style="color: inherit"> <button class="btn btn-lg">Sign
                                Up</button></a>
                    </div>
                </div>
            </div>
            <div class="col-sm-4">
                <div class="panel panel-default text-center">
                    <div class="panel-heading">
                        <h1 id="jobseeker">Job Seekers</h1>
                    </div>
                    <div class="panel-body">
                        <p style="font-size: 16px">Helps passive and active jobseekers find better jobs. Get connected
                            with over 10000 recruiters.
                            Apply to jobs in just one click. Apply to thousands of jobs posted daily.</p>
                    </div>
                    <div class="panel-footer">
                        <a href="js_register.html" style="color: inherit"><button class="btn btn-lg">
                                Sign Up</button></a>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="container bg-grey" id="contact">
        <div class="page-header" style="background: #f4511e"></div>
        <h2 class="text-center" id="contact">CONTACT US</h2>
        <div class="page-header"></div>
        <div class="row">
            <div class="col-sm-5">
                <p>Contact us and we'll get back to you within 24 hours.</p>
                <p><span class="glyphicon glyphicon-map-marker"></span> Vellore, India</p>
                <p><span class="glyphicon glyphicon-phone"></span> +91 9876785432</p>
                <p><span class="glyphicon glyphicon-envelope"></span> info@jobsearch.com</p>
            </div>

            <div class="col-sm-7">
                <div class="row">
                    <div class="col-sm-6 form-group">
                        <input class="form-control" id="name" name="name" placeholder="Name" type="text" required>
                    </div>
                    <div class="col-sm-6 form-group">
                        <input class="form-control" id="email" name="email" placeholder="Email" type="email" required>
                    </div>
                </div>
                <textarea class="form-control" id="comments" name="comments" placeholder="Comment"
                    rows="5"></textarea><br>
                <div class="row">
                    <div class="col-sm-12 form-group">
                        <button class="btn btn-default pull-right" type="submit">Send</button>
                    </div>
                </div>
            </div>
        </div>
    </div> <!-- Contact -->

    </div> <!-- sub content -->
    <div class="page-header" style="background: #f4511e"></div>
    </div> <!-- Container -->
    <!-- Set height and width with CSS -->
    <div id="googleMap" style="height:400px;width:100%;"></div>

    <!-- Add Google Maps -->
    <script src="http://maps.googleapis.com/maps/api/js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        var myCenter = new google.maps.LatLng(11.2680519, 75.7891479);

        function initialize() {
            var mapProp = {
                center: myCenter,
                zoom: 12,
                scrollwheel: false,
                draggable: false,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };

            var map = new google.maps.Map(document.getElementById("googleMap"), mapProp);

            var marker = new google.maps.Marker({
                position: myCenter,
            });

            marker.setMap(map);
        }

        google.maps.event.addDomListener(window, 'load', initialize);

        //axios
        let subcontent = document.getElementById('subcontent');

        const homesearch = document.getElementById('homesearch');
        homesearch.addEventListener("submit", e => {
            e.preventDefault()
            keyword = document.getElementById('keyword').value;
            keyword2 = document.getElementById('keyword2').value;
            axios.get(`/jobs/search?p1=${keyword}&p2=${keyword2}`)
                .then(res => dynamicSearchRes(res.data)) //succ
                .catch(err => console.log(err)) //err
        });



        function dynamicSearchRes(data) {

            console.log(JSON.stringify(data[1]));

            //init
            let fragment = new DocumentFragment();
            const keys = Object.keys(data);
            subcontent.innerHTML = '';

            //check if values present
            if(keys.length > 0){

                //first listing
                let ul = document.createElement('ul');
                //append, as a child to the <div<
                subcontent.appendChild(ul);

                //iterate over each result; number of results
                for (let i = 0; i < keys.length; i++) {
                    const key = keys[i];
                    console.log(key, data[key]);

                    //<li> -> <ul>
                    let li = document.createElement('li');
                    let ulInner = document.createElement('ul');
                    
                    //iteration fragment
                    let fragmentInner = new DocumentFragment();

                    //iterate over each object in the returned JSON
                    for (const obj in data[key]) {
                        if(obj=='_id' || obj == '__v' ) {
                            continue;
                        }
                        //console.log(obj);
                        //console.log(data[key][obj]);

                        value = data[key][obj];
                        let li1 = document.createElement('li');
                        li1.innerHTML = `${obj}: ${value}`;
                        fragmentInner.append(li1);
                    }

                    //when finished append fragmentInner <li>...<li>n as a child to inner ul
                    ulInner.appendChild(fragmentInner);

                    //append inner <UL> inside one of the <li> tags
                    li.appendChild(ulInner);

                    //when finished append to outer fragment <li> collection of lists
                    fragment.append(li);
                    }
                ul.appendChild(fragment);
            }
        };


    </script>
</body>
</body>

</html>
